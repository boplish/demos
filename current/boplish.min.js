(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null,"undefined"!=typeof navigator&&navigator.mozGetUserMedia?(console.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),createIceServer=function(e,t,r){var n=null,o=e.split(":");if(0===o[0].indexOf("stun"))n={url:e};else if(0===o[0].indexOf("turn")&&(-1!==e.indexOf("transport=udp")||-1===e.indexOf("?transport"))){var a=e.split("?");n={url:a[0],credential:r,username:t}}return n},attachMediaStream=function(e,t){console.log("Attaching media stream"),e.mozSrcObject=t,e.play()},reattachMediaStream=function(e,t){console.log("Reattaching media stream"),e.mozSrcObject=t.mozSrcObject,e.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]}):"undefined"!=typeof navigator&&navigator.webkitGetUserMedia?(console.log("This appears to be Chrome"),webrtcDetectedBrowser="chrome",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10),createIceServer=function(e,t,r){var n=null,o=e.split(":");if(0===o[0].indexOf("stun"))n={url:e};else if(0===o[0].indexOf("turn"))if(28>webrtcDetectedVersion){var a=e.split("turn:");n={url:"turn:"+t+"@"+a[1],credential:r}}else n={url:e,credential:r,username:t};return n},RTCPeerConnection=webkitRTCPeerConnection,getUserMedia=navigator.webkitGetUserMedia.bind(navigator),attachMediaStream=function(e,t){"undefined"!=typeof e.srcObject?e.srcObject=t:"undefined"!=typeof e.mozSrcObject?e.mozSrcObject=t:"undefined"!=typeof e.src?e.src=URL.createObjectURL(t):console.log("Error attaching stream to element.")},reattachMediaStream=function(e,t){e.src=t.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):console.log("Browser does not appear to be WebRTC-capable");
//# sourceMappingURL=out.js.map

},{}],2:[function(require,module,exports){
(function (process){
var ConnectionManager=require("./connectionmanager.js"),Router=require("./router.js"),sha1=require("./sha1.js");BOPlishClient=function(e,r,o){var n=this.utils.whatBrowserAmI();if("Firefox"===n.vendor&&Number(n.version.slice(0,2))>=26);else if("Chrome"===n.vendor&&Number(n.version.slice(0,2))>=33);else if("Node.js"!==n.vendor)return void o("You will not be able to use BOPlish as your browser is currently incompatible. Please use either Firefox 26 or Chrome 33 upwards.");if(this.id=sha1.hash(Math.random().toString()),e=e||window.location.host,"/"!==e.substring(e.length-1,e.length)&&(e+="/"),"wss://"!==e.substring(0,6)&&"ws://"!==e.substring(0,5))return void o("Syntax error in bootstrapHost parameter");var t=new WebSocket(e+"ws/"+this.id);t.onerror=function(r){o("Failed to open connection to bootstrap server:"+e+": "+r)},t.onopen=function(){this._connectionManager.bootstrap(this._router,r,o)}.bind(this),this._connectionManager=new ConnectionManager,this._router=new Router(this.id,t,this._connectionManager)},BOPlishClient.prototype={utils:{whatBrowserAmI:function(){if("undefined"!=typeof process&&"undefined"!=typeof module)return{vendor:"Node.js",version:process.version};var e,r=navigator.userAgent,o=navigator.appName,n=r.match(/(opera|chrome|safari|firefox|msie|trident)\/?\s*([\d\.]+)/i)||[];return n=n[2]?[n[1],n[2]]:[o,navigator.appVersion,"-?"],n&&null!==(e=r.match(/version\/([\.\d]+)/i))&&(n[2]=e[1]),{vendor:n[0],version:n[1]}}},send:function(e,r,o){this._router.route(e,r,o)},setOnMessageHandler:function(e,r){this._router.registerDeliveryCallback(e,r)},setMonitorCallback:function(e){this._router.registerMonitorCallback(e)},getConnectedPeers:function(){return this._router.getPeerIds()}},"undefined"!=typeof module&&(module.exports=BOPlishClient);
//# sourceMappingURL=out.js.map

}).call(this,require("FWaASH"))
},{"./connectionmanager.js":4,"./router.js":6,"./sha1.js":7,"FWaASH":8}],3:[function(require,module,exports){
var BopURI=function(i){if(!(this instanceof BopURI))return new BopURI(i);var t=i.indexOf("/"),o=i.slice(0,t),e=o.split(":");if(this.scheme=e[0],this.uid=e[1],this.protocol=e[2],-1!=t){var r=i.slice(t),s=r.indexOf("?");-1==s?this.path=r:(this.path=r.slice(0,s),this.query=r.slice(s+1))}if(void 0===this.scheme||void 0===this.uid||void 0===this.protocol)throw new Error("Tried to create URI from wrongly formatted string");return this};BopURI.prototype={},"undefined"!=typeof module&&(module.exports=BopURI);
//# sourceMappingURL=out.js.map

},{}],4:[function(require,module,exports){
var Peer=require("./peer.js"),ConnectionManager=function(){return this instanceof ConnectionManager?(this._bootstrap=null,this._pending={},this._connections={},this._state="uninitialized",this):new ConnectionManager};ConnectionManager.prototype={utils:{findInSDP:function(e,n){var t=[];return e.split("\r\n").forEach(function(e){e.match(new RegExp("^"+n+"="))&&t.push(e.split("=",2)[1])}),t},findSessionId:function(e){return parseInt(this.findInSDP(e,"o")[0].split(" ")[1],10)}},bootstrap:function(e,n,t){if("uninitialized"!==this._state)return void t("Invalid state");this._state="bootstrapping",this._router=e;var i=new RTCPeerConnection(null),s="*";this._bootstrap={pc:i,dc:i.createDataChannel(null,{}),onsuccess:n,onerror:t},e.registerDeliveryCallback("signaling-protocol",this._onMessage.bind(this)),i.createOffer(this._onCreateOfferSuccess.bind(this,i,s,this._bootstrap,t),this._onCreateOfferError.bind(this,t))},connect:function(e,n,t){if("ready"!==this._state)return void t("Invalid state");void 0!==this._pending[e]&&t("Already connecting");var i=new RTCPeerConnection(this._pcoptions),s=i.createDataChannel(null,{});this._pending[e]={pc:i,dc:s,onsuccess:n,onerror:t},i.createOffer(this._onCreateOfferSuccess.bind(this,i,e,this._pending[e],t),this._onCreateOfferError.bind(this,t))},_onCreateOfferSuccess:function(e,n,t,i,s){t.drop||(e.onicecandidate=function(t){("complete"===e.iceGatheringState||null===t.candidate)&&(e.onicecandidate=function(){},e.createOffer(function(e){this._router.route(n,"signaling-protocol",e)}.bind(this),this._onCreateOfferError.bind(this,i)))}.bind(this),t.offerId=this.utils.findSessionId(s.sdp),e.setLocalDescription(s))},_onCreateOfferError:function(e,n){e(n)},_onMessage:function(e,n){switch(e.type){case"offer":this._onReceiveOffer(e,n);break;case"answer":this._onReceiveAnswer(e,n);break;case"denied":this._onOfferDenied(e,n);break;default:console.log("ConnectionManager: Discarding JSEP message because the type is unknown: "+JSON.stringify(e))}},_onReceiveAnswer:function(e,n){if("bootstrapping"===this._state)this._bootstrap.pc.setRemoteDescription(new RTCSessionDescription(e)),this._bootstrap.dc.onopen=function(){this._router.addPeer(new Peer(n,this._bootstrap.pc,this._bootstrap.dc)),this._state="ready",this._bootstrap.onsuccess(),this._bootstrap=null}.bind(this);else{var t=this._pending[n];if(void 0===t)return;t.pc.setRemoteDescription(new RTCSessionDescription(e)),t.dc.onopen=function(){var e=new Peer(n,t.pc,t.dc);this._router.addPeer(e),"function"==typeof t.onsuccess&&t.onsuccess(),delete this._pending[n],this._connections[n]=e}.bind(this)}},_onReceiveOffer:function(e,n){(void 0!==this._connections[n]||void 0!==this._pending[n])&&this._router.route(n,"signaling-protocol",{type:"denied"});var t=this.utils.findSessionId(e.sdp);if("bootstrapping"===this._state){if(null!==this._bootstrap.pc.remoteDescription)return;if(!(t>this._bootstrap.offerId))return;var i={pc:new RTCPeerConnection(this._pcoptions),onsuccess:this._bootstrap.onsuccess,onerror:this._bootstrap.onerror};this._bootstrap.drop=!0,this._bootstrap=i,this._bootstrap.pc.setRemoteDescription(new RTCSessionDescription(e)),this._bootstrap.pc.ondatachannel=function(e){e.channel.onopen=function(){var t=new Peer(n,this._bootstrap.pc,e.channel);this._router.addPeer(t),this._state="ready",this._bootstrap.onsuccess(),this._connections[n]=t,this._bootstrap=null}.bind(this)}.bind(this),this._bootstrap.pc.createAnswer(this._onCreateAnswerSuccess.bind(this,n,this._bootstrap.pc),this._onCreateAnswerError.bind(this))}else{var s=this._pending[n];if(void 0!==s){if(!(t>s.offerId))return;newPendingOffer={onsuccess:s.onsuccess,onerror:s.onerror},s=newPendingOffer,delete this._pending[n]}var o=new RTCPeerConnection(this._pcoptions);o.setRemoteDescription(new RTCSessionDescription(e)),this._pending[n]=s||{},this._pending[n].pc=o,o.ondatachannel=function(e){e.channel.onopen=function(){var t=new Peer(n,o,e.channel);this._router.addPeer(t),"function"==typeof this._pending[n].onsuccess&&this._pending[n].onsuccess(),delete this._pending[n],this._connections[n]=t}.bind(this)}.bind(this),o.createAnswer(this._onCreateAnswerSuccess.bind(this,n,o),this._onCreateAnswerError.bind(this))}},_onCreateAnswerSuccess:function(e,n,t){n.onicecandidate=function(t){("complete"===n.iceGatheringState||null===t.candidate)&&(n.onicecandidate=function(){},this._router.route(e,"signaling-protocol",n.localDescription))}.bind(this),n.setLocalDescription(new RTCSessionDescription(t))},_onCreateAnswerError:function(e){console.log(e)},_onOfferDenied:function(){"bootstrapping"===this._state&&(this._bootstrap.pc=new RTCPeerConnection(this._pcoptions),this._bootstrap.dc=this._bootstrap.pc.createDataChannel(null,{}),this._bootstrap.offerId=null,this._bootstrap.onsuccess(),this._bootstrap.onsuccess=function(){})}},"undefined"!=typeof module&&(module.exports=ConnectionManager);
//# sourceMappingURL=out.js.map

},{"./peer.js":5}],5:[function(require,module,exports){
var Peer=function(e,n,t){return this instanceof Peer?(this.id=e,this.peerConnection=n,void(this.dataChannel=t)):new Peer(e,n,t)};"undefined"!=typeof module&&(module.exports=Peer);
//# sourceMappingURL=out.js.map

},{}],6:[function(require,module,exports){
var Peer=require("./peer.js"),Router=function(e,t,s){return this instanceof Router?(this._peerTable={},this._fallbackSignaling=t,this._fallbackSignaling.onmessage=this.onmessage.bind(this),this._connectionManager=s,this._id=e,this._messageCallbacks={},this._monitorCallback=null,this.registerDeliveryCallback("discovery",this._onDiscoveryMessage.bind(this)),this):new Router};Router.prototype={addPeer:function(e){this._peerTable[e.id]=e,e.dataChannel.onmessage=this.onmessage.bind(this),e.peerConnection.onclosedconnection=this.removePeer.bind(this,e),1===Object.keys(this._peerTable).length&&this._discoverNeighbours(e)},removePeer:function(e){delete this._peerTable[e.id]},getPeerIds:function(){var e,t=[];for(e in this._peerTable)this._peerTable.hasOwnProperty(e)&&t.push(e);return t},onmessage:function(e){try{this.forward(JSON.parse(e.data))}catch(t){console.log("Unable to parse incoming message "+JSON.stringify(e.data)+": "+t)}},route:function(e,t,s){this.forward({to:e,from:this._id,type:t,payload:s})},forward:function(e){if("function"==typeof this._monitorCallback&&this._monitorCallback(e),!e.to)throw Error("Unable to route message because no recipient can be determined");if(this._id===e.to)return void this.deliver(e);var t=this._peerTable[e.to];if(!(t instanceof Peer))return void this._fallbackSignaling.send(JSON.stringify(e));try{t.dataChannel.send(JSON.stringify(e))}catch(s){console.log("Unable to route message to "+e.to+" because the DataChannel connection failed.")}},deliver:function(e){try{this._messageCallbacks[e.type](e.payload,e.from)}catch(t){console.log("Unable to handle message of type "+e.type+" from "+e.from+" because no callback is registered: "+t)}},registerDeliveryCallback:function(e,t){this._messageCallbacks[e]=t},registerMonitorCallback:function(e){this._monitorCallback=e},_discoverNeighbours:function(e){this.route(e.id,"discovery",{type:"request"})},_onDiscoveryMessage:function(e,t){switch(e.type){case"answer":this._processDiscoveryAnswer(e,t);break;case"request":this._processDiscoveryRequest(e,t);break;default:console.log("Router: received invalid discovery message with type %s from %s",e.type,t)}},_processDiscoveryAnswer:function(e){var t,s=e.ids;for(t=0;t<s.length;t++)s[t]!==this._id&&this._connectionManager.connect(s[t])},_processDiscoveryRequest:function(e,t){var s,i=[];for(s in this._peerTable)this._peerTable.hasOwnProperty(s)&&this._peerTable[s]instanceof Peer&&i.push(s);this.route(t,"discovery",{type:"answer",ids:i})}},"undefined"!=typeof module&&(module.exports=Router);
//# sourceMappingURL=out.js.map

},{"./peer.js":5}],7:[function(require,module,exports){
var sha1=function(r){function n(r){return e(t(o(r)))}function t(r){return a(u(f(r),8*r.length))}function e(r){var n,t,e=g?"0123456789ABCDEF":"0123456789abcdef",o="";for(t=0;t<r.length;t++)n=r.charCodeAt(t),o+=e.charAt(n>>>4&15)+e.charAt(15&n);return o}function o(r){for(var n,t,e="",o=-1;++o<r.length;)n=r.charCodeAt(o),t=o+1<r.length?r.charCodeAt(o+1):0,n>=55296&&56319>=n&&t>=56320&&57343>=t&&(n=65536+((1023&n)<<10)+(1023&t),o++),127>=n?e+=String.fromCharCode(n):2047>=n?e+=String.fromCharCode(192|n>>>6&31,128|63&n):65535>=n?e+=String.fromCharCode(224|n>>>12&15,128|n>>>6&63,128|63&n):2097151>=n&&(e+=String.fromCharCode(240|n>>>18&7,128|n>>>12&63,128|n>>>6&63,128|63&n));return e}function f(r){var n,t=[],e=r.length>>2;for(n=0;e>n;n++)t[n]=0;for(n=0;n<8*r.length;n+=8)t[n>>5]|=(255&r.charCodeAt(n/8))<<24-n%32;return t}function a(r){var n,t="";for(n=0;n<32*r.length;n+=8)t+=String.fromCharCode(r[n>>5]>>>24-n%32&255);return t}function u(r,n){r[n>>5]|=128<<24-n%32,r[(n+64>>9<<4)+15]=n;var t,e,o=new Array(80),f=1732584193,a=-271733879,u=-1732584194,g=271733878,d=-1009589776;for(t=0;t<r.length;t+=16){var v=f,l=a,A=u,m=g,S=d;for(e=0;80>e;e++){o[e]=16>e?r[t+e]:C(o[e-3]^o[e-8]^o[e-14]^o[e-16],1);var s=i(i(C(f,5),h(e,a,u,g)),i(i(d,o[e]),c(e)));d=g,g=u,u=C(a,30),a=f,f=s}f=i(f,v),a=i(a,l),u=i(u,A),g=i(g,m),d=i(d,S)}return[f,a,u,g,d]}function h(r,n,t,e){return 20>r?n&t|~n&e:40>r?n^t^e:60>r?n&t|n&e|t&e:n^t^e}function c(r){return 20>r?1518500249:40>r?1859775393:60>r?-1894007588:-899497514}function i(r,n){var t=(65535&r)+(65535&n),e=(r>>16)+(n>>16)+(t>>16);return e<<16|65535&t}function C(r,n){return r<<n|r>>>32-n}var g=0;return r.hash=n,r}("undefined"==typeof exports?{}:exports);
//# sourceMappingURL=out.js.map

},{}],8:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    if (canPost) {
        var queue = [];
        window.addEventListener('message', function (ev) {
            var source = ev.source;
            if ((source === window || source === null) && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
}

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

},{}]},{},[1,2,3,4,5,6,7])